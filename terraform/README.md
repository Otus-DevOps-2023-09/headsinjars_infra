# Выполнено ДЗ №7

 - [+] Основное ДЗ
 - [+] Задание со *
 - [-] Задание со **

## В процессе сделано:
 - Создана новая ветка terraform-2
 - Определены неявные зависимости ресурсов в порядке примененения (создания)
 - Протестирована работа с мета-аргументом depends_on (явное определение зависимостей)
 - Изменена структура проекта: app и db пересобраны packer'ом в качестве отдельных образов ВМ
 - Создание ресурсов вынесено в отдельные файлы из maim.tf (app.tf, db.tf, vpc.tf)
 - Применен принцип организации кода с модулями: app и db создаются, вызывая соответствующие модули. Это позволяет сократить объемы кода и создавать большое количество повторяющихся инстансов с небольшими изменениями
 - Принцип модульной структуры применен для создания инстансов для prod и stage веток проекта.
 - Реализован удаленный backend для хранения и совместной работы с .state файлом. Состояние инфраструктуры хранится на s3 bucket'e.
 - Реализована совместная работа через state locking (блокировку состояний) для предотвращения одновременного изменения ресурсов разными членами команды. В YC создана таблица Yandex Managed Service for YBD     (аналог DynamoDB в AWS).

## Как запустить проект:
 - Перейти в каталог prod (stage)
   cd ./prod (или cd ./stage)
 - предварительно загрузить в переменные окружения статический ключ и секрет для сервисного аккаунта с доступом к s3 bucket:
   export ACCESS_KEY="<идентификатор_ключа>"
   export SECRET_KEY="<секретный_ключ>"
 - Запустить terraform init -reconfigure -backend-config="access_key=$ACCESS_KEY" -backend-config="secret_key=$SECRET_KEY"
 - Запустить terraform plan для проверки планируемых изменений
 - Запустить terraform apply для применения изменений в инфраструктуре

## Как проверить работоспособность:
 - Проверить значения выходных переменных external_ip_address_app, external_ip_address_db
 - Подключиться к инстансам по адресам переменных.

## PR checklist
 - [+] Выставил label с номером домашнего задания
 - [+] Выставил label с темой домашнего задания
 
